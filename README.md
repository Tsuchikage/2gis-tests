2gis-tests. Тестовое задание QAA.
---

### Установка зависимостей

```bash
pip install -r requirements.txt
```

---

### Запуск автотестов (CRUD + Smoke + API)

```bash
pytest -v -m "smoke and api or crud and api" --envFile=configuration/dev-example.com.env
```

---

### Примечания

* Маркеры `smoke`, `crud`, `api` используются для отбора нужных тестов.
* Аргумент `--envFile` передаёт путь к ENV-файлу с настройками стенда.
* Флаг `--allureReport` включает сбор результатов для Allure (формирует директорию logs/reports/allure-results).
* Флаг `--htmlReport` включает генерацию HTML-отчёта pytest и сохраняет его в logs/reports/html.
---

### Просмотр Allure-отчёта и html-отчета после прогона

После выполнения тестов открыть сгенерированный HTML-отчёт:

```bash
allure open logs/reports/allure-report
```
## Схема проекта.

```markdown
2gis-tests/                                  
├── autotests/                               # Автотесты
│   ├── api/                                 
│   │   ├── api_data/                        # Тестовые данные
│   │   │   └── regions_data_api.py          
│   │   ├── api_helpers/                     # Хелперы
│   │   │   └── regions_helper_api.py        
│   │   ├── api_methods/                     # REST-методы
│   │   │   ├── auth_methods_api.py          
│   │   │   └── regions_methods_api.py       
│   │   └── api_tests/                       # API-тесты
│   │       ├── crud/                        # CRUD-тесты
│   │       │   └── test_regions_crud_api.py 
│   │       └── negative/                    # Негативные проверки API
│   │           └── smoke/                   # Smoke негативные тесты
│   │               └── test_regions_negative_smoke_api.py  
│
├── configuration/                           # Конфигурация окружений
│   ├── dev-example.com.env                  
│   └── dev-example.com.env.aes              
│
├── logs/                                    # Логи и отчёты прогонов тестов
│   └── reports/
│       ├── allure-report/                   # Сгенерированный Allure-репорт
│       ├── allure-results/                  
│       └── html/                            # HTML-отчёт pytest-html
│           └── assets/
│               └── report_smoke...html      
│
├── settings/                                # Техническая инфраструктура фреймворка
│   ├── api_client/                          # Общий HTTP-клиент/обёртка над requests
│   │   └── api_client.py
│   ├── assertions/                          # Кастомные assert-функции
│   │   └── custom_assertions.py
│   ├── configs/                             # Работа с конфигами и env
│   │   ├── config_model.py                  
│   │   └── env_config_loader.py             
│   ├── constants/                           # Константы проекта (пути, дефолтные значения и т.п.)
│   │   └── constants_settings.py
│   ├── data/                                # Общие генераторы тестовых данных
│   │   └── data_generator_abstraction.py
│   ├── encryption/                          # Шифрование/расшифровка файлов, .env и т.п.
│   │   └── encryption.py
│   ├── report/                              # Модель автотеста для отчётности
│   │   └── autotest.py
│   └── utils.py                             # Утилиты
│
├── conftest.py                              # Общие фикстуры pytest (конфиг, клиент, подготовка окружения)
├── pytest.ini                               # Настройки запуска pytest (markers, options)
├── README.md                                
└── requirements.txt                         
```
---

# Задание 1

### Протестируйте API метод создания избранного места и оформите баг-репорт с найденными ошибками.

---

## Баг 1. Отсутствует валидация длины `title` при создании избранного места

**Наименование:** Избранное место с некорректной длиной `title` возвращает 200

**Тип:** Bug

**Приоритет:** Высокий

**Компонент:** `Regions`

**Окружение**: https://regions-test.2gis.com

**Версия:** regions-dev1.0.0

**Предусловие:**

1. Успешно выполнен запрос `POST /v1/auth/tokens`.
2. В клиенте сохранен cookie `token=<валидный_токен>`.

**Шаги для воспроизведения:**

1. Отправить запрос `POST /v1/favorites` с полем `title > 999`.
   ```json
   {
     "title": "A................................................................", 
     "lat": 55.028254,
     "lon": 82.918501,
     "color": "GREEN"
   }
   ```

**Ожидаемый результат:**

* Возвращается 400 статус код.

**Фактический результат:**

* Для `title` длиной > 999 символов сервер возвращает 200 статус код.

---

## Баг 2. Ошибка 500 при создании места с полями `lat=0`, `lon=0`

**Наименование:** Ошибка 500 при создании места с полями lat=0, lon=0

**Тип:** Bug

**Приоритет:** Высокий

**Компонент:** `Regions`

**Окружение:** https://regions-test.2gis.com

**Версия:** regions-dev1.0.0

**Предусловие:**

1. Успешно выполнен запрос `POST /v1/auth/tokens`.
2. В клиенте сохранен cookie `token=<валидный_токен>`.

**Шаги для воспроизведения:**

1. Отправить запрос `POST /v1/favorites` с полями `lat=0`, `lon=0`:

   ```json
   {
     "title": "Name",
     "lat": 0,
     "lon": 0,
     "color": "GREEN"
   }
   ```

**Ожидаемый результат:**

* Возвращается 200 статус код.

**Фактический результат:**

* Сервер возвращает 500 статус код.

---

# Задание 2

### Составьте тест-кейсы и напишите по ним авто-тесты, проверяющие корректность работы API метода создания избранного места. Каждый авто-тест должен состоять как минимум из двух шагов: формирование запроса к серверу и сравнение результата с ожидаемым значением проверяемого тест-кейса.

---

## ТК1. CRUD Create (RegionsApi). Создание избранного места.

**Маркер:** `crud, api`

**Приоритет:** Высокий

**Предусловия:**

* Стенд `https://regions-test.2gis.com`
* Получен валидный сессионный токен через `POST /v1/auth/tokens`
* Токен передаётся в запросе в cookie `token`

**Шаги:**

| № | Действие                                                                                                                                                            | Ожидаемый результат                                             |
|---|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| 1 | Выполнить запрос `POST /v1/favorites` с валидными данными (`title`, `lat`, `lon`, `color`).                                                                         | Сервер возвращает статус-код `200 OK`.                          |
| 2 | Проверить тело ответа: `title`, `lat`, `lon`, `color` совпадают с отправленными значениями; `id` - целое число; `created_at` в формате `YYYY-MM-DDThh:mm:ss±hh:mm`. | Поля ответа корректные, объект избранного места успешно создан. |

---

## ТК101. Negative Smoke. Создание избранного места с некорректным title.

**Маркер:** `smoke, api, negative`

**Приоритет:** Средний

**Тестовые данные:**

* Вариант 1: `title = ""` (пустая строка)
* Вариант 2: `title = "A"*1000` (1000 символов - превышение допустимой длины
    999)

**Предусловия:**

* Стенд `https://regions-test.2gis.com`
* Получен валидный сессионный токен, передаётся в cookie `token`

**Шаги:**

| № | Действие                                                                                                             | Ожидаемый результат                  |
|---|----------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| 1 | Выполнить запрос `POST /v1/favorites` с валидными `lat`, `lon`, `color`, но невалидным `title` (из тестовых данных). | Сервер возвращает `400 Bad Request`. |
| 2 | Проверить статус-код ответа.                                                                                         | Статус-код ответа `400 Bad Request`. |

---
